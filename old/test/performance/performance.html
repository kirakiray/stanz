<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>performance test</title>
    <script src="../../dist/stanz.js"></script>
    <script src="./stanz6.js"></script>
</head>

<body>

    <script>
        // 创造一个复杂对象
        function createTestObj(len) {
            let childs = [];
            let obj = {
                childs
            };
            for (let i = 0; i < 200000; i++) {
                childs.push({
                    val: `I am ${i}`
                    // val: `change val`
                });
            }
            return obj;
        }

        let testObj = createTestObj();

        let p_handler = {
            set(target, key, value, receiver) {
                if (typeof key === "symbol") {
                    return Reflect.set(target, key, value, receiver);
                }
                target[key] = value;
                // return Reflect.set(target, key, value, receiver);
            }
        };
        let p_data_0 = createTestObj();
        p_data_0.childs = p_data_0.childs.map(e => {
            return new Proxy(e, p_handler);
        });
        let proxydata = new Proxy(p_data_0, p_handler);
        let pdata = {
            v: proxydata
        }

        console.time("stanz 7 init");
        let s7data = stanz({ v: testObj });
        console.timeEnd("stanz 7 init");
        // s7data.v.childs.forEach(e => e._update = false)

        console.time("stanz 6 init");
        let s6data = stanz6({ v: testObj });
        console.timeEnd("stanz 6 init");
        // s6data.v.childs.forEach(e => e._update = false)

        console.time("proxy data set");
        for (let i = 0; i < 50000; i++) {
            pdata.v.childs[i].val = `change ${i} val`;
        }
        console.timeEnd("proxy data set");

        console.time("stanz 7 set");
        for (let i = 0; i < 50000; i++) {
            s7data.v.childs[i].val = `change ${i} val`;
            // s7data.v.childs[i].setData("val", `change ${i} val`);
        }
        console.timeEnd("stanz 7 set");


        console.time("stanz 6 set");
        for (let i = 0; i < 50000; i++) {
            s6data.v.childs[i].val = `change ${i} val`;
        }
        console.timeEnd("stanz 6 set");

        console.time("proxy data get");
        for (let i = 0; i < 200000; i++) {
            let a = pdata.v.childs[i].val;
        }
        console.timeEnd("proxy data get");

        console.time("stanz 7 get");
        for (let i = 0; i < 200000; i++) {
            let a = s7data.v.childs[i].val;
        }
        console.timeEnd("stanz 7 get");

        console.time("stanz 6 get");
        for (let i = 0; i < 200000; i++) {
            let a = s6data.v.childs[i].val;
        }
        console.timeEnd("stanz 6 get");



        console.time("proxy data unshift");
        pdata.v.childs.unshift({
            val: "new 0"
        });
        console.timeEnd("proxy data unshift");

        console.time("stanz 7 unshift");
        s7data.v.childs.unshift({
            val: "new 0"
        });
        console.timeEnd("stanz 7 unshift");

        console.time("stanz 6 unshift");
        s6data.v.childs.unshift({
            val: "new 0"
        });
        console.timeEnd("stanz 6 unshift");


    </script>
</body>

</html>